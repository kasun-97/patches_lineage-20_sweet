From 046115f095a1b5f0252bfc79d1113479dac75519 Mon Sep 17 00:00:00 2001
From: spkal01 <kalligeross@gmail.com>
Date: Sun, 1 May 2022 15:37:31 +0300
Subject: [PATCH 2/3] Settings: Remove refresh rate category on unsupported
 devices

Signed-off-by: Karan Parashar <whyredfire@gmail.com>
Change-Id: I18c8006f5fb36eeb4dd7a25e491a0e729f9cc2ef
[ghostrider-reborn: simplify and clean up]
Signed-off-by: Adithya R <gh0strider.2k18.reborn@gmail.com>
---
 res/xml/display_settings.xml                  | 26 +++++++++----------
 src/com/android/settings/DisplaySettings.java |  7 +++++
 2 files changed, 20 insertions(+), 13 deletions(-)

diff --git a/res/xml/display_settings.xml b/res/xml/display_settings.xml
index 36f8242a98..20adf5c00f 100644
--- a/res/xml/display_settings.xml
+++ b/res/xml/display_settings.xml
@@ -99,7 +99,8 @@
     </PreferenceCategory>
 
     <PreferenceCategory
-        android:title="@string/category_name_refresh_rate_controls">
+        android:title="@string/category_name_refresh_rate_controls"
+        android:key="refresh_rate_category">
 
         <SwitchPreference
             android:key="peak_refresh_rate"
@@ -113,6 +114,17 @@
             android:summary="@string/force_high_refresh_rate_desc"
             settings:controller="com.android.settings.display.ForcePeakRefreshRatePreferenceController"/>
 
+        <ListPreference
+            android:key="max_refresh_rate"
+            android:title="@string/max_refresh_rate_title"
+            android:summary="@string/summary_placeholder"
+            settings:controller="com.android.settings.display.PeakRefreshRateListPreferenceController" />
+
+        <ListPreference
+            android:key="min_refresh_rate"
+            android:title="@string/min_refresh_rate_title"
+            android:summary="@string/summary_placeholder"
+            settings:controller="com.android.settings.display.MinRefreshRatePreferenceController" />
     </PreferenceCategory>
 
     <PreferenceCategory
@@ -146,18 +158,6 @@
             android:summary="@string/display_white_balance_summary"
             settings:controller="com.android.settings.display.DisplayWhiteBalancePreferenceController"/>
 
-        <ListPreference
-            android:key="max_refresh_rate"
-            android:title="@string/max_refresh_rate_title"
-            android:summary="@string/summary_placeholder"
-            settings:controller="com.android.settings.display.PeakRefreshRateListPreferenceController" />
-
-        <ListPreference
-            android:key="min_refresh_rate"
-            android:title="@string/min_refresh_rate_title"
-            android:summary="@string/summary_placeholder"
-            settings:controller="com.android.settings.display.MinRefreshRatePreferenceController" />
-
         <SwitchPreference
             android:key="show_operator_name"
             android:title="@string/show_operator_name_title"
diff --git a/src/com/android/settings/DisplaySettings.java b/src/com/android/settings/DisplaySettings.java
index 1de331d2d7..150466fe97 100644
--- a/src/com/android/settings/DisplaySettings.java
+++ b/src/com/android/settings/DisplaySettings.java
@@ -20,6 +20,7 @@ import android.app.settings.SettingsEnums;
 import android.content.Context;
 import android.os.Bundle;
 
+import com.android.settings.R;
 import com.android.settings.dashboard.DashboardFragment;
 import com.android.settings.display.BrightnessLevelPreferenceController;
 import com.android.settings.display.CameraGesturePreferenceController;
@@ -45,6 +46,7 @@ public class DisplaySettings extends DashboardFragment {
     private static final String KEY_HIGH_TOUCH_POLLING_RATE = "high_touch_polling_rate_enable";
     private static final String KEY_HIGH_TOUCH_SENSITIVITY = "high_touch_sensitivity_enable";
     private static final String KEY_PROXIMITY_ON_WAKE = "proximity_on_wake";
+    private static final String KEY_REFRESH_RATE_CATEGORY = "refresh_rate_category";
 
     @Override
     public int getMetricsCategory() {
@@ -64,6 +66,11 @@ public class DisplaySettings extends DashboardFragment {
     @Override
     public void onCreate(Bundle icicle) {
         super.onCreate(icicle);
+
+        if (!getActivity().getResources().getBoolean(R.bool.config_show_smooth_display)
+           && !getActivity().getResources().getBoolean(R.bool.config_show_min_refresh_rate_switch)) {
+            getPreferenceScreen().removePreference(findPreference(KEY_REFRESH_RATE_CATEGORY));
+        }
     }
 
     @Override
-- 
2.25.1

